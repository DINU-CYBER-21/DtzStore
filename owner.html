<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dtz Store</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');
  body {
    background: #121212;
    color: #eee;
    font-family: 'Poppins', sans-serif;
    margin: 0; padding: 2rem;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
  }
  .container {
    background: #222;
    padding: 2rem 2.5rem;
    border-radius: 12px;
    width: 400px;
    box-shadow: 0 0 20px #ff0033aa;
    animation: fadeInScale 0.4s ease forwards;
  }
  @keyframes fadeInScale {
    from {
      opacity: 0;
      transform: scale(0.9);
    } to {
      opacity: 1;
      transform: scale(1);
    }
  }
  h2 {
    text-align: center;
    color: #ff0033;
    margin-bottom: 1rem;
  }
  input, textarea {
    width: 100%;
    background: #333;
    border: none;
    border-radius: 7px;
    padding: 0.6rem 0.8rem;
    color: #eee;
    font-size: 1rem;
    margin-bottom: 1rem;
    font-family: 'Poppins', sans-serif;
    resize: none;
  }
  textarea {
    min-height: 100px;
  }
  button {
    background: #ff0033;
    border: none;
    color: white;
    padding: 0.7rem 1.5rem;
    font-weight: 700;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1rem;
    transition: background 0.3s ease;
  }
  button:hover {
    background: #e6002a;
  }
  .tabs {
    display: flex;
    justify-content: space-between;
    margin-bottom: 1rem;
  }
  .tab-btn {
    flex: 1;
    background: #ff4466;
    margin-right: 0.5rem;
    border-radius: 7px;
    font-weight: 700;
    font-size: 0.9rem;
    transition: background 0.3s ease;
    cursor: pointer;
    padding: 0.6rem 0;
    color: white;
  }
  .tab-btn:last-child {
    margin-right: 0;
  }
  .tab-btn.active {
    background: #ff0033;
    box-shadow: 0 0 10px #ff0033aa;
  }
  #logout-btn {
    background: #555 !important;
    margin-top: 1rem;
    width: 100%;
  }
  #message {
    margin-top: 0.6rem;
    text-align: center;
    font-weight: 600;
  }
  #error {
    color: #ff4444;
    margin-top: 0.4rem;
    text-align: center;
  }
  label {
    font-weight: 600;
    margin-bottom: 0.4rem;
    display: block;
  }
  .hidden {
    display: none !important;
  }
</style>
</head>
<body>

<div class="container">

  <!-- Login Form -->
  <div id="login-form">
    <h2>Owner Login</h2>
    <input type="email" id="email" placeholder="Email" required autocomplete="username" />
    <input type="password" id="password" placeholder="Password" required autocomplete="current-password" />
    <button id="login-btn">Login</button>
    <p id="error"></p>
  </div>

  <!-- Panel -->
  <div id="panel" class="hidden">
    <h2>Add New Content</h2>
    <div class="tabs">
      <button class="tab-btn active" data-type="text">Text</button>
      <button class="tab-btn" data-type="link">Link</button>
      <button class="tab-btn" data-type="photo">Photo URL</button>
      <button class="tab-btn" data-type="file">File URL / Upload</button>
    </div>

    <form id="add-form">
      <label id="input-label" for="input-content">Text Content:</label>
      <textarea id="input-content" placeholder="Enter content here..." required></textarea>
      <input type="file" id="file-upload" class="hidden" />
      <button type="submit">Save Content</button>
    </form>
    <button id="logout-btn">Logout</button>
    <p id="message"></p>
  </div>

</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    addDoc,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-firestore.js";
  import {
    getStorage,
    ref,
    uploadBytes,
    getDownloadURL
  } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-storage.js";

  // Firebase config (ඔයාගේ Firebase config එක මෙහි දාලා තියෙන්න)
  const firebaseConfig = {
    apiKey: "AIzaSyAeUFi-IKSFPHk1ZBSnjZ-4ri7BzizxV2I",
    authDomain: "dcktsula.firebaseapp.com",
    databaseURL: "https://dcktsula-default-rtdb.firebaseio.com",
    projectId: "dcktsula",
    storageBucket: "dcktsula.firebasestorage.app",
    messagingSenderId: "104670460847",
    appId: "1:104670460847:web:ecfcafd7528f1b1c8b8d5a",
    measurementId: "G-2XXP969SM9"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const storage = getStorage(app);

  // Elements
  const loginForm = document.getElementById('login-form');
  const panel = document.getElementById('panel');
  const loginBtn = document.getElementById('login-btn');
  const logoutBtn = document.getElementById('logout-btn');
  const errorP = document.getElementById('error');
  const messageP = document.getElementById('message');
  const addForm = document.getElementById('add-form');
  const inputContent = document.getElementById('input-content');
  const inputLabel = document.getElementById('input-label');
  const fileUpload = document.getElementById('file-upload');
  const tabButtons = document.querySelectorAll('.tab-btn');

  let currentType = 'text';

  // Hardcoded owner credentials
  const OWNER_EMAIL = "dinalolla@.com";
  const OWNER_PASSWORD = "dinaponnaya";

  // Switch form according to tab
  function updateForm(type){
    currentType = type;
    inputContent.value = '';
    messageP.textContent = '';
    errorP.textContent = '';

    tabButtons.forEach(btn => {
      btn.classList.toggle('active', btn.getAttribute('data-type') === type);
    });

    if(type === 'text'){
      inputLabel.textContent = 'Text Content:';
      inputContent.placeholder = 'Enter text content here...';
      inputContent.classList.remove('hidden');
      fileUpload.classList.add('hidden');
      inputContent.required = true;
    }
    else if(type === 'link'){
      inputLabel.textContent = 'Link URL:';
      inputContent.placeholder = 'https://example.com';
      inputContent.classList.remove('hidden');
      fileUpload.classList.add('hidden');
      inputContent.required = true;
    }
    else if(type === 'photo'){
      inputLabel.textContent = 'Photo URL (or upload below):';
      inputContent.placeholder = 'https://example.com/photo.jpg';
      inputContent.classList.remove('hidden');
      fileUpload.classList.remove('hidden');
      inputContent.required = false;
    }
    else if(type === 'file'){
      inputLabel.textContent = 'File URL (or upload below):';
      inputContent.placeholder = 'https://example.com/file.pdf';
      inputContent.classList.remove('hidden');
      fileUpload.classList.remove('hidden');
      inputContent.required = false;
    }
  }

  tabButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      updateForm(btn.getAttribute('data-type'));
    });
  });

  // Login logic
  loginBtn.addEventListener('click', () => {
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;

    errorP.textContent = '';

    if(email === OWNER_EMAIL && password === OWNER_PASSWORD){
      loginForm.classList.add('hidden');
      panel.classList.remove('hidden');
      updateForm('text');
    } else {
      errorP.textContent = 'Invalid email or password';
    }
  });

  // Logout logic
  logoutBtn.addEventListener('click', () => {
    loginForm.classList.remove('hidden');
    panel.classList.add('hidden');
    messageP.textContent = '';
    errorP.textContent = '';
    inputContent.value = '';
  });

  // Upload file to Firebase Storage and get URL
  async function uploadFile(file) {
    const storageRef = ref(storage, `uploads/${Date.now()}_${file.name}`);
    await uploadBytes(storageRef, file);
    const url = await getDownloadURL(storageRef);
    return url;
  }

  // Form submit handler
  addForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    messageP.style.color = '#eee';
    errorP.textContent = '';

    let content = inputContent.value.trim();

    if(currentType === 'photo' || currentType === 'file'){
      if(fileUpload.files.length > 0){
        try {
          messageP.style.color = '#ffdd55';
          messageP.textContent = 'Uploading file... Please wait.';
          const uploadedUrl = await uploadFile(fileUpload.files[0]);
          content = uploadedUrl;
          messageP.style.color = '#77ff77';
          messageP.textContent = 'File uploaded successfully!';
        } catch(err){
          errorP.textContent = 'File upload failed: ' + err.message;
          return;
        }
      } else {
        // For photo/file type, URL must be filled if no file upload
        if(!content){
          errorP.textContent = 'Please enter a URL or upload a file.';
          return;
        }
      }
    } else {
      if(!content){
        errorP.textContent = 'Content cannot be empty.';
        return;
      }
    }

    try {
      await addDoc(collection(db, "dtzstore_contents"), {
        type: currentType,
        content: content,
        createdAt: serverTimestamp()
      });
      messageP.style.color = '#77ff77';
      messageP.textContent = 'Content saved successfully!';
      inputContent.value = '';
      fileUpload.value = '';
    } catch(err) {
      errorP.textContent = 'Error saving content: ' + err.message;
    }
  });
</script>

</body>
</html>
